{% extends "base.html" %}
{% block title %}{{ serie_name }} — {{ episode_name }}{% endblock %}

{% block content %}
<div class="watch-shell" data-next-url="{{ url_for('watch', relative_path=next_episode) if next_episode else '' }}">
    <div class="watch-top">
        <a class="btn btn-ghost btn-back" href="{{ url_for('serie_detail', serie_name=serie_name) }}">
            Voltar para {{ serie_name }}
        </a>
        <button type="button" class="btn btn-ghost" id="openSettings">
            Configurações
        </button>
    </div>

    <div class="watch-headings">
        {% if season_name %}
            <p class="watch-meta">
                {{ season_name }}
                {% if episode_index %} • Episódio {{ episode_index }}{% endif %}
            </p>
        {% endif %}
        <h1 class="page-title">{{ serie_name }}</h1>
        <p class="episode-title">{{ episode_name }}</p>
    </div>

    <div class="video-wrapper">
        <video id="videoPlayer" controls autoplay playsinline>
            <source src="{{ url_for('stream', relative_path=relative_path) }}" type="video/mp4">
            Seu navegador não suporta o elemento de vídeo.
        </video>
    </div>

    <div class="episode-nav">
        {% if prev_episode %}
            <a class="btn btn-ghost" href="{{ url_for('watch', relative_path=prev_episode) }}">
                Episódio anterior
            </a>
        {% endif %}
        {% if next_episode %}
            <a class="btn btn-primary" href="{{ url_for('watch', relative_path=next_episode) }}">
                Próximo episódio
            </a>
        {% endif %}
    </div>
</div>

<div id="settingsPanel" class="settings-panel hidden">
    <div class="settings-box">
        <h2>Configurações de reprodução</h2>

        <label class="settings-row">
            <input type="checkbox" id="autoplayToggle">
            <span>Autoplay do próximo episódio</span>
        </label>

        <label class="settings-row">
            <span>Tempo do autoplay:</span>
            <select id="autoplayDelaySelect">
                <option value="5">5 segundos</option>
                <option value="10">10 segundos</option>
                <option value="20">20 segundos</option>
            </select>
        </label>

        <button type="button" class="btn btn-ghost settings-close" id="closeSettings">Fechar</button>
    </div>
</div>

{% if next_episode %}
    <div id="autoplayOverlay" class="autoplay-overlay hidden">
        <div class="autoplay-box">
            <h2>Próximo episódio</h2>
            <p>Vai começar em <span id="countdown">10</span> segundos...</p>

            <div class="autoplay-buttons">
                <a class="btn btn-primary" href="{{ url_for('watch', relative_path=next_episode) }}">
                    Assistir agora
                </a>
                <button class="btn btn-ghost" id="cancelAutoplay">Cancelar</button>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/watch.js') }}" defer></script>
{% endblock %}
