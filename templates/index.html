<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Minhas S√©ries ‚Äî MINI-FLIX</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

<header class="header">
    <div class="header-inner">
        <div class="logo">MINI-FLIX</div>

        <div class="header-right">
            <div class="nav">
                <a href="{{ url_for('index') }}">In√≠cio</a>
                <input id="searchInput" type="text" placeholder="Buscar s√©rie..." class="search-input">
            </div>

            {% if current_user.is_authenticated %}
            <div class="user-menu">
                <a href="{{ url_for('profile') }}" class="avatar-link" title="Perfil">
                    <img src="{{ current_user.avatar_url }}" alt="Avatar">
                </a>
                <a href="{{ url_for('logout') }}" class="user-link logout-link">Sair</a>
            </div>
            {% endif %}

        </div>
    </div>
</header>


<div class="container">

    {% if continue_list %}
        <h2 class="section-title">Continuar assistindo</h2>
        <div class="grid">
            {% for item in continue_list %}
                <a class="card" href="{{ url_for('watch', relative_path=item.relative_path) }}">
                    <div class="poster-wrapper skeleton">
                        {% if item.poster %}
                            <img class="poster"
                                 src="{{ url_for('media_file', relative_path=item.poster) }}"
                                 alt="Poster de {{ item.serie_name }}">
                        {% else %}
                            <div class="card-placeholder-text">
                                {{ item.serie_name }}
                            </div>
                        {% endif %}
                    </div>
                    <div class="card-info">
                        <p class="card-title">{{ item.serie_name }}</p>
                        <span class="tag">Continuar</span>
                        <div class="muted">√öltimo epis√≥dio: {{ item.episode_name }}</div>
                    </div>
                </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h2>Bem-vindo(a) ao MINI-FLIX üçø</h2>
            <p>Voc√™ ainda n√£o come√ßou nenhuma s√©rie. Escolha uma abaixo para come√ßar a maratonar.</p>
        </div>
    {% endif %}

    <h2 class="section-title">Todas as s√©ries</h2>

    {% if series_cards %}
        <div class="grid" id="seriesGrid">
            {% for serie in series_cards %}
                <a class="card series-card"
                   data-name="{{ serie.name | lower }}"
                   href="{{ url_for('serie_detail', serie_name=serie.name) }}">
                    <div class="poster-wrapper skeleton">
                        {% if serie.poster %}
                            <img class="poster"
                                 src="{{ url_for('media_file', relative_path=serie.poster) }}"
                                 alt="Poster de {{ serie.name }}">
                        {% else %}
                            <div class="card-placeholder-text">
                                {{ serie.name }}
                            </div>
                        {% endif %}
                    </div>
                    <div class="card-info">
                        <p class="card-title">{{ serie.name }}</p>
                    </div>
                </a>
            {% endfor %}
        </div>
    {% else %}
        <p class="muted">Nenhuma s√©rie encontrada na pasta configurada.</p>
    {% endif %}

</div>

<script>
    // Skeleton + fade
    function markImageLoaded(img) {
        img.classList.add("loaded");
        const wrapper = img.closest(".skeleton");
        if (wrapper) {
            wrapper.classList.add("loaded");
        }
    }

    document.querySelectorAll("img.poster").forEach(function (img) {
        if (img.complete) {
            markImageLoaded(img);
        } else {
            img.addEventListener("load", function () {
                markImageLoaded(img);
            });
        }
    });

    // Busca simples de s√©ries
    const searchInput = document.getElementById("searchInput");
    const cards = document.querySelectorAll(".series-card");

    if (searchInput) {
        searchInput.addEventListener("input", function () {
            const term = this.value.trim().toLowerCase();

            cards.forEach(card => {
                const name = card.dataset.name;
                card.style.display = (!term || name.includes(term)) ? "" : "none";
            });
        });
    }
</script>

</body>
</html>
